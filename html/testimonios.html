<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testimonios | Tus Asesores LLC</title>
    <link rel="stylesheet" href="../css/estilo-testimonio.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="../img/Isotipo Principal.png"> 
    
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '2065949323809830');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=2065949323809830&ev=PageView&noscript=1"/></noscript>
    
    <script src="//widget.manychat.com/1383933_10644.js" defer="defer"></script>
    <script src="https://mccdn.me/assets/js/widget.js" defer="defer"></script>
</head>
<body>

    <header id="menu" class="navbar">
        <div class="container">
            <div class="logo">
                <img src="../img/Logo Naranja.png" alt="Tus Asesores, LLC">
            </div>
            
            <div class="navbar-right">
                <a href="newsletter.html" class="btn-nav-mobile">Regístrate</a>
                <button class="menu-toggle" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>

            <nav class="nav-menu">
                <ul>
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="sobrenosotros.html">Sobre Nosotros</a></li>
                    <li><a href="servicios.html">Servicios</a></li>
                    <li><a href="testimonios.html">Testimonios</a></li>
                    <li><a href="recursos.html">Recursos</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                    <li class="btn-desktop-li"><a href="newsletter.html" class="btn-nav">Regístrate</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="home" class="hero-section">
        <div class="background-overlay"></div>
        <div class="container">
            <h1>Tu éxito es nuestra mayor garantía</h1>
            <p>Conoce las experiencias de quienes han confiado su crecimiento financiero en nosotros.</p>
        </div>
    </section>

    <main class="comments-page">
        <div class="container">
            <header class="section-header">
                <span class="subtitle">Tu opinión es importante para nosotros</span>
                <h2>Testimonios de Clientes</h2>
            </header>

            <section class="form-section">
                <div class="comment-form-box">
                    <h3>¿Cómo ha sido tu experiencia?</h3>
                    <form id="form-comentario">
                        <div class="input-row">
                            <input type="text" id="nombre" placeholder="Tu Nombre completo" required>
                            
                            <div class="rating-selection">
                                <span>Tu Calificación:</span>
                                <div class="stars-input">
                                    <input type="radio" name="rating" id="star-5" value="5" checked><label for="star-5"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star-4" value="4"><label for="star-4"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star-3" value="3"><label for="star-3"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star-2" value="2"><label for="star-2"><i class="fas fa-star"></i></label>
                                    <input type="radio" name="rating" id="star-1" value="1"><label for="star-1"><i class="fas fa-star"></i></label>
                                </div>
                            </div>
                        </div>
                        
                        <input type="hidden" id="cargo" value="Cliente">

                        <textarea id="mensaje" rows="4" placeholder="Escribe aquí tu testimonio..." required></textarea>
                        <button type="submit" id="btn-submit" class="btn-submit">Publicar mi comentario</button>
                    </form>
                </div>
            </section>

            <section id="grid-comentarios" class="dynamic-grid"></section>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-top">
            <div class="footer-logo">
                <a href="#home">
                    <img src="../img/Isotipo Naranja.png" alt="Logotipo" class="footer-logo-image">
                </a>
            </div>
            
            <div class="footer-links">
                <div class="link-column">
                    <h4>Servicios</h4>
                    <ul>
                        <li><a href="servicios.html#contabilidad">● Contabilidad</a></li>
                        <li><a href="servicios.html#taxes">● Taxes</a></li>
                        <li><a href="servicios.html#nuevaempresa">● Nueva Empresa en USA</a></li>
                        <li><a href="servicios.html#asesoria">● Asesoría Financiera</a></li>
                    </ul>
                </div>
                
                <div class="link-column">
                    <h4>De interés</h4>
                    <ul>
                        <li><a href="sobrenosotros.html#equipo">● Quiénes Somos</a></li>
                        <li><a href="recursos.html">● Cursos y Recursos</a></li>
                        <li><a href="newsletter.html">● Boletín Semanal</a></li>
                    </ul>
                </div>
                
                <div class="link-column">
                    <h4>Contacto</h4>
                    <ul>
                        <li><a href="mailto:info@tusasesoresllc.com">● info@tusasesoresllc.com</a></li>
                        <li><a href="https://wa.me/13059854905">● +1 (305) 985-4905</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 Tus Asesores, LLC. Todos los derechos reservados.</p>
        </div>
    </footer>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, onChildRemoved, remove } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD2PoWyxufgEMZnBEsoIkRho__z6vr-Ljc",
        authDomain: "tus-asesores.firebaseapp.com",
        databaseURL: "https://tus-asesores-default-rtdb.firebaseio.com",
        projectId: "tus-asesores",
        storageBucket: "tus-asesores.firebasestorage.app",
        messagingSenderId: "41149254149",
        appId: "1:41149254149:web:65e109d9451c8651848520"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const testimoniosRef = ref(db, 'testimonios');

    const form = document.getElementById('form-comentario');
    const grid = document.getElementById('grid-comentarios');

    // --- LÓGICA DE ADMINISTRADOR ---
    let modoAdmin = sessionStorage.getItem('isAdminTusAsesores') === 'true';
    let dKeyPressCount = 0;

    document.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'd') {
            dKeyPressCount++;
            if (dKeyPressCount === 3) {
                const pass = prompt("Acceso Administrador - Ingresa Clave:");
                if (pass === "tusasesores2026") {
                    modoAdmin = !modoAdmin;
                    sessionStorage.setItem('isAdminTusAsesores', modoAdmin);
                    alert(modoAdmin ? "MODO EDICIÓN ACTIVADO" : "MODO EDICIÓN DESACTIVADO");
                    location.reload();
                }
                dKeyPressCount = 0;
            }
        } else { dKeyPressCount = 0; }
    });

    // --- MOSTRAR COMENTARIOS ---
    onChildAdded(testimoniosRef, (snapshot) => {
        const data = snapshot.val();
        const id = snapshot.key;
        const card = document.createElement('div');
        card.className = 'oliver-card';
        card.id = `card-${id}`;
        
        // Botón de eliminar (Solo si modoAdmin es true)
        const botonEliminar = modoAdmin ? 
            `<button class="btn-delete" style="background:#ff4444; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer; width:100%; margin-top:10px; font-weight:bold;">ELIMINAR</button>` : '';

        card.innerHTML = `
            <div class="card-top">
                <h4>${data.nombre}</h4>
                <span>${data.cargo || 'Cliente'}</span>
            </div>
            <p>${data.mensaje}</p>
            ${botonEliminar}
        `;
        grid.prepend(card);

        // Acción de eliminar
        if (modoAdmin) {
            card.querySelector('.btn-delete').onclick = async () => {
                if (confirm("¿Segura que quieres borrar este comentario permanentemente?")) {
                    await remove(ref(db, `testimonios/${id}`));
                }
            };
        }
    });

    // --- QUITAR COMENTARIO DE LA PANTALLA AL BORRAR ---
    onChildRemoved(testimoniosRef, (snapshot) => {
        const el = document.getElementById(`card-${snapshot.key}`);
        if (el) el.remove();
    });

    // --- ENVIAR COMENTARIO ---
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btn-submit');
        btn.disabled = true;

        try {
            const nuevo = {
                nombre: document.getElementById('nombre').value,
                cargo: document.getElementById('cargo').value,
                mensaje: document.getElementById('mensaje').value,
                rating: 5,
                fecha: new Date().toISOString()
            };
            await push(testimoniosRef, nuevo);
            form.reset();
            alert("¡Testimonio publicado!");
        } catch (error) {
            alert("Error al publicar.");
        } finally {
            btn.disabled = false;
        }
    });
</script>
    <script src="../js/script.js"></script>
</body>
</html>